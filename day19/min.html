<body id=b><script>var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var g=0;return function(){return g<a.length?{done:!1,value:a[g++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var g="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return g?g.call(a):$jscomp.arrayIterator(a)};
C={unit:"px",camX:0,camY:0,camZ:0,camRX:0,camRY:0,camRZ:0,sprite_count:0,sprites:[],plane_count:0,cube_count:0,options:{},$:function(a){return document.getElementById(a)},init:function(a){a.css||(a.css="");a.html||(a.html="");a.g||(a.g="scene");a.o||(a.o="center");"bottom"==a.o&&(a.y-=a.h/2);a.w||(a.w=0);a.h||(a.h=0);a.x||(a.x=0);a.y||(a.y=0);a.z||(a.z=0);a.rx||(a.rx=0);a.ry||(a.ry=0);a.rz||(a.rz=0);a.sx||(a.sx=1);a.sy||(a.sy=1);a.sz||(a.sz=1);C.options[a.n]=a},group:function(a){a.d||0===a.d||(a.d=
a.h);C.init(a);C.$(a.g).innerHTML+='<div id="'+a.n+'"class="group '+a.css+'"style="position:absolute;width:'+a.w+C.unit+";height:"+a.d+C.unit+";background:"+a.b+";transform:"+C.tr(a)+'">'},plane:function(a){a.n||(a.n="plane"+C.plane_count++);C.init(a);C.$(a.g).innerHTML+='<div id="'+a.n+'"class="plane '+a.css+'"style="position:absolute;width:'+a.w+C.unit+";height:"+a.h+C.unit+";background:"+a.b+";transform-origin:"+a.o+";transform:"+C.tr(a)+'">'+a.html;C.camera()},sprite:function(a){a.n||(a.n="sprite"+
C.sprite_count++);C.init(a);C.$(a.g).innerHTML+='<div id="'+a.n+'"class="sprite '+a.css+'"style="position:absolute;width:'+a.w+C.unit+";height:"+a.h+C.unit+";background:"+a.b+";transform-origin:"+a.o+";transform:"+C.tr(a)+'">'+a.html;C.sprites.push(a.n);C.camera()},cube:function(a){a.n||(a.n="cube"+C.cube_count++);C.init(a);C.group(a);C.plane({g:a.n,x:a.w/2,y:a.d/2,w:a.w,h:a.d,b:a.b,css:"bottom"});C.plane({g:a.n,y:a.d/2,w:a.d,h:a.h,b:a.b,rx:-90,ry:-90,o:"bottom",css:"left"});C.plane({g:a.n,x:a.w,
y:a.d/2,w:a.d,h:a.h,b:a.b3,rx:-90,ry:-90,o:"bottom",css:"right"});C.plane({g:a.n,x:a.w/2,y:0,w:a.w,h:a.h,b:a.b2,rx:-90,o:"bottom",css:"back"});C.plane({g:a.n,x:a.w/2,y:a.d,w:a.w,h:a.h,b:a.b2,rx:-90,o:"bottom",css:"front"});C.plane({g:a.n,x:a.w/2,y:a.d/2,z:a.h,w:a.w,h:a.d,b:a.b,css:"top"})},camera:function(a){a&&(a.x||0===a.x)&&(C.camX=a.x);a&&(a.y||0===a.y)&&(C.camY=a.y);a&&(a.z||0===a.z)&&(C.camZ=a.z);a&&(a.rx||0===a.rx)&&(C.camRX=a.rx);a&&(a.ry||0===a.ry)&&(C.camRY=a.ry);a&&(a.rz||0===a.rz)&&(C.camRZ=
a.rz);C.camX+=(Math.random()-.5)/1E3;scene.style.transformOrigin=""+C.camX+C.unit+" "+C.camY+C.unit;scene.style.transform="translateX("+-C.camX+C.unit+")translateY("+-C.camY+C.unit+")translateZ("+-C.camZ+C.unit+")rotateX("+C.camRX+"deg)rotateY("+C.camRY+"deg)rotateZ("+C.camRZ+"deg)";for(var g in C.sprites){a=C.$(C.sprites[g]);var e=a.style.transform.replace(/ *rotate.*\(.*?deg\)/g,"");a.style.transform=e+("rotateZ("+-C.camRZ+"deg)rotateX("+-C.camRX+"deg)")}},move:function(a){if(a.n){var g=C.$(a.n),
e=C.options[a.n];if(a.x||0===a.x)e.x=a.x;if(a.y||0===a.y)e.y=a.y;if(a.z||0===a.z)e.z=a.z;if(a.rx||0===a.rx)e.rx=a.rx;if(a.ry||0===a.ry)e.ry=a.ry;if(a.rz||0===a.rz)e.rz=a.rz;C.options[a.n]=e;g.style.transform=C.tr(e)}},tr:function(a){return("top left"==a.o?"":"translateX(-50%)translateY(-50%)")+"translateX("+a.x+C.unit+")translateY("+a.y+C.unit+")translateZ("+a.z+C.unit+")rotateX("+a.rx+"deg)rotateY("+a.ry+"deg)rotateZ("+a.rz+"deg)"}};window.b=b;window.s=window.u=window.l=window.d=window.r=0;
window.S=window.U=window.L=window.D=window.R=0;window._=window.$=0;
var mode=1,world=0,puzzle=0,race=0,size=100,sizeh=50,cx=25,cy=25,cz=30,crx=55,cry=0,crz=0,carx=10*size+size/2,cary=16*size+size/2,carrz=0,carspeed=0,front=[0,0,0],back=[0,0,0],frontcell=[0,0],backcell=[0,0],oob=0,collision=0,speedduringcollision=0,fcell,bcell,fcellinfo,bcellinfo,space=[],roads=[],roadlinks=[],gridz=0,gridrz=0,gridrzreal=0,cursorx=0,cursory=0,cursorrz=0,cursorrzreal=0,selected=0,rerender=0,inventory=[],ev,i,j,k,x,y,z,block,times,toRadians=function(a){return Math.PI/180*a},dist2=function(a,
g){return Math.pow(a[0]-g[0],2)+Math.pow(a[1]-g[1],2)},delog=function(){return deb.innerHTML=""},log=function(a){for(var g=[],e=0;e<arguments.length;++e)g[e-0]=arguments[e];return deb.innerHTML+=g+"\n"},barriers=function(a){a=$jscomp.makeIterator(a);x=a.next().value;y=a.next().value;z=a.next().value;if(0==z&&(block=space[x][y][z])){a="u";for(var g="r",e="d",c="l",f=0;f<block.angle;f+=90)c=$jscomp.makeIterator([g,e,c,a]),a=c.next().value,g=c.next().value,e=c.next().value,c=c.next().value;if(0==block.id){if(C.$("road-"+
x+"-"+y+"-"+z).children[0].style.border="0",block.barriers={u:0,r:0,d:0,l:0},block.links.u||block.links.r||block.links.d||block.links.l)block.links[a]||block.links[e]?block.links[c]||block.links[g]?block.links[a]&&block.links[c]&&!block.links[g]&&!block.links[e]?(block.barriers[g]=1,block.barriers[e]=1):block.links[a]&&!block.links[c]&&block.links[g]&&!block.links[e]?(block.barriers[c]=1,block.barriers[e]=1):!block.links[a]&&block.links[c]&&!block.links[g]&&block.links[e]&&(block.barriers[g]=1,block.barriers[a]=
1):(block.barriers[c]=1,block.barriers[g]=1):(block.barriers[a]=1,block.barriers[e]=1),!block.links[a]&&!block.links[c]&&block.links[g]&&block.links[e]?(block.barriers[a]=1,block.barriers[c]=1):block.links[a]&&block.links[g]&&block.links[e]&&!block.links[c]?block.barriers[c]=1:block.links[a]&&block.links[g]&&!block.links[e]&&block.links[c]?block.barriers[e]=1:block.links[a]&&!block.links[g]&&block.links[e]&&block.links[c]?block.barriers[g]=1:!block.links[a]&&block.links[g]&&block.links[e]&&block.links[c]&&
(block.barriers[a]=1)}else 1==block.id?(C.$("road-"+x+"-"+y+"-"+z).children[0].style.border="0",block.barriers={u:1,r:1,d:1,l:1},0==block.angle&&block.links.u&&(block.barriers.u=0),90==block.angle&&block.links.r&&(block.barriers.r=0),180==block.angle&&block.links.d&&(block.barriers.d=0),270==block.angle&&block.links.l&&(block.barriers.l=0)):2==block.id?(C.$("road-"+x+"-"+y+"-"+z).children[0].style.border="0",block.barriers={u:1,r:1,d:1,l:1},0==block.angle&&block.links.d&&(block.barriers.d=0),90==
block.angle&&block.links.l&&(block.barriers.l=0),180==block.angle&&block.links.u&&(block.barriers.u=0),270==block.angle&&block.links.r&&(block.barriers.r=0)):3==block.id?(C.$("road-"+x+"-"+y+"-"+z).children[0].style.border="0",block.barriers={u:1,r:1,d:1,l:1},0==block.angle&&block.links.d&&(block.barriers.u=0,block.barriers.d=0),90==block.angle&&block.links.l&&(block.barriers.l=0,block.barriers.r=0),180==block.angle&&block.links.u&&(block.barriers.u=0,block.barriers.d=0),270==block.angle&&block.links.r&&
(block.barriers.l=0,block.barriers.r=0)):4==block.id?(C.$("road-"+x+"-"+y+"-"+z).children[0].style.border="0",block.barriers={u:0,r:0,d:0,l:0},0!=block.angle||block.links.d||(block.barriers.d=1),90!=block.angle||block.links.l||(block.barriers.l=1),180!=block.angle||block.links.u||(block.barriers.u=1),270!=block.angle||block.links.r||(block.barriers.r=1)):5==block.id?(C.$("road-"+x+"-"+y+"-"+z).children[0].style.border="0",block.barriers={u:0,r:0,d:0,l:0},0!=block.angle||block.links.d||(block.barriers.d=
1),90!=block.angle||block.links.l||(block.barriers.l=1),180!=block.angle||block.links.u||(block.barriers.u=1),270!=block.angle||block.links.r||(block.barriers.r=1)):6==block.id?(C.$("road-"+x+"-"+y+"-"+z).children[0].style.border="0",block.barriers={u:0,r:0,d:0,l:0},0!=block.angle||block.links.d||(block.barriers.d=1),90!=block.angle||block.links.l||(block.barriers.l=1),180!=block.angle||block.links.u||(block.barriers.u=1),270!=block.angle||block.links.r||(block.barriers.r=1)):7==block.id?(C.$("road-"+
x+"-"+y+"-"+z).children[0].style.border="0",block.barriers={u:0,r:0,d:0,l:0},0!=block.angle||block.links.d||(block.barriers.d=1),90!=block.angle||block.links.l||(block.barriers.l=1),180!=block.angle||block.links.u||(block.barriers.u=1),270!=block.angle||block.links.r||(block.barriers.r=1)):8==block.id?(C.$("road-"+x+"-"+y+"-"+z).children[0].style.border="0",block.barriers={u:1,r:1,d:1,l:1},0==block.angle&&block.links.d&&(block.barriers.u=0,block.barriers.d=0),90==block.angle&&block.links.l&&(block.barriers.l=
0,block.barriers.r=0),180==block.angle&&block.links.u&&(block.barriers.u=0,block.barriers.d=0),270==block.angle&&block.links.r&&(block.barriers.l=0,block.barriers.r=0)):9==block.id&&(C.$("road-"+x+"-"+y+"-"+z).children[0].style.border="0",block.barriers={u:0,r:0,d:0,l:0},0!=block.angle||block.links.d||(block.barriers.d=1),90!=block.angle||block.links.l||(block.barriers.l=1),180!=block.angle||block.links.u||(block.barriers.u=1),270!=block.angle||block.links.r||(block.barriers.r=1));block.barriers[a]&&
(C.$("road-"+x+"-"+y+"-"+z).children[0].style.borderTop="5px solid #000");block.barriers[e]&&(C.$("road-"+x+"-"+y+"-"+z).children[0].style.borderBottom="5px solid #000");block.barriers[c]&&(C.$("road-"+x+"-"+y+"-"+z).children[0].style.borderLeft="5px solid #000");block.barriers[g]&&(C.$("road-"+x+"-"+y+"-"+z).children[0].style.borderRight="5px solid #000")}},links=function(){for(var a=$jscomp.makeIterator(document.querySelectorAll(".barrierleftright,.barriertopbottom")),g=a.next();!g.done;g=a.next())j=
g.value,j.remove();a=$jscomp.makeIterator(roadlinks);for(g=a.next();!g.done;g=a.next())if(i=g.value,i[0]){g=space[i[0][0]][i[0][1]][i[0][2]];var e=space[i[1][0]][i[1][1]][i[1][2]];i[0][0]==i[1][0]&&i[0][1]<i[1][1]&&(g.slope||e.slope?g.slope&&!e.slope?C.plane({n:1,w:.8*size,h:.1*size,x:i[1][0]*size+.1*size,y:i[1][1]*size+1*size-size,z:sizeh*i[1][2]+1,b:"#d90",o:"top left",css:"barrierleftright "+(0==i[1][2]?"z0":"")}):!g.slope&&e.slope&&C.plane({n:2,w:.8*size,h:.1*size,x:i[0][0]*size+.1*size,y:i[0][1]*
size+.9*size,z:sizeh*i[0][2]+1,b:"#d90",o:"top left",css:"barrierleftright "+(0==i[0][2]?"z0":"")}):C.plane({n:"zer0",w:.8*size,h:.2*size,x:i[0][0]*size+.1*size,y:i[0][1]*size+.9*size,z:sizeh*i[0][2]+1,b:"#d90",o:"top left",css:"barrierleftright "+(0==i[0][2]?"z0":"")}),g.links.d=[i[1][0],i[1][1],i[1][2]],e.links.u=[i[0][0],i[0][1],i[0][2]]);i[0][0]==i[1][0]&&i[0][1]>i[1][1]&&(g.slope||e.slope?g.slope&&!e.slope?C.plane({n:11,w:.8*size,h:.1*size,x:i[1][0]*size+.1*size,y:i[1][1]*size+.9*size,z:sizeh*
i[1][2]+1,b:"#d90",o:"top left",css:"barrierleftright "+(0==i[1][2]?"z0":"")}):!g.slope&&e.slope&&C.plane({n:12,w:.8*size,h:.1*size,x:i[1][0]*size+.1*size,y:i[1][1]*size+size,z:sizeh*i[1][2]+1,b:"#d90",o:"top left",css:"barrierleftright "+(0==i[1][2]?"z0":"")}):C.plane({n:10,w:.8*size,h:.2*size,x:i[1][0]*size+.1*size,y:i[1][1]*size+.9*size,z:sizeh*i[1][2]+1,b:"#d90",o:"top left",css:"barrierleftright "+(0==i[1][2]?"z0":"")}),g.links.u=[i[1][0],i[1][1],i[1][2]],e.links.d=[i[0][0],i[0][1],i[0][2]]);
i[0][0]<i[1][0]&&i[0][1]==i[1][1]&&(g.slope||e.slope?g.slope&&!e.slope?C.plane({n:21,w:.1*size,h:.8*size,x:i[1][0]*size,y:i[1][1]*size+.1*size,z:sizeh*i[1][2]+1,b:"#d90",o:"top left",css:"barriertopbottom "+(0==i[1][2]?"z0":"")}):!g.slope&&e.slope&&C.plane({n:22,w:.1*size,h:.8*size,x:i[0][0]*size+.9*size,y:i[0][1]*size+.1*size,z:sizeh*i[0][2]+1,b:"#d90",o:"top left",css:"barriertopbottom "+(0==i[0][2]?"z0":"")}):C.plane({n:20,w:.2*size,h:.8*size,x:i[0][0]*size+.9*size,y:i[1][1]*size+.1*size,z:sizeh*
i[0][2]+1,b:"#d90",o:"top left",css:"barriertopbottom "+(0==i[0][2]?"z0":"")}),g.links.r=[i[1][0],i[1][1],i[1][2]],e.links.l=[i[0][0],i[0][1],i[0][2]]);i[0][0]>i[1][0]&&i[0][1]==i[1][1]&&(g.slope||e.slope?g.slope&&!e.slope?C.plane({n:31,w:.1*size,h:.8*size,x:i[1][0]*size+.9*size,y:i[1][1]*size+.1*size,z:sizeh*i[1][2]+1,b:"#d90",o:"top left",css:"barriertopbottom "+(0==i[1][2]?"z0":"")}):!g.slope&&e.slope&&C.plane({n:32,w:.1*size,h:.8*size,x:i[0][0]*size,y:i[0][1]*size+.1*size,z:sizeh*i[0][2]+1,b:"#d90",
o:"top left",css:"barriertopbottom "+(0==i[0][2]?"z0":"")}):C.plane({n:30,w:.2*size,h:.8*size,x:i[1][0]*size+.9*size,y:i[1][1]*size+.1*size,z:sizeh*i[1][2]+1,b:"#d90",o:"top left",css:"barriertopbottom "+(0==i[1][2]?"z0":"")}),g.links.l=[i[1][0],i[1][1],i[1][2]],e.links.r=[i[0][0],i[0][1],i[0][2]])}},turns=function(){for(var a=$jscomp.makeIterator(roads),g=a.next();!g.done;g=a.next())if(i=g.value)g=$jscomp.makeIterator(i),x=g.next().value,y=g.next().value,z=g.next().value,(block=space[x][y][z])&&
0==block.id&&(block.flat={u:1,r:1,d:1,l:1},block.links.u&&block.links.r&&!block.links.d&&!block.links.l?(C.$("road-"+x+"-"+y+"-"+z).children[0].style.borderRadius="0 0 0 100%",block.flat.d=0,block.flat.l=0):!block.links.u&&block.links.r&&block.links.d&&!block.links.l?(C.$("road-"+x+"-"+y+"-"+z).children[0].style.borderRadius="100% 0 0 0",block.flat.u=0,block.flat.l=0):!block.links.u&&!block.links.r&&block.links.d&&block.links.l?(C.$("road-"+x+"-"+y+"-"+z).children[0].style.borderRadius="0 100% 0 0",
block.flat.u=0,block.flat.r=0):block.links.u&&!block.links.r&&!block.links.d&&block.links.l?(C.$("road-"+x+"-"+y+"-"+z).children[0].style.borderRadius="0 0 100% 0",block.flat.d=0,block.flat.r=0):C.$("road-"+x+"-"+y+"-"+z)&&(C.$("road-"+x+"-"+y+"-"+z).children[0].style.borderRadius="0",block.flat.u=0,block.flat.r=0,block.flat.d=0,block.flat.l=0))},equations=function(){for(var a=$jscomp.makeIterator(roads),g=a.next();!g.done;g=a.next())if(i=g.value)g=$jscomp.makeIterator(i),x=g.next().value,y=g.next().value,
z=g.next().value,(block=space[x][y][z])&&0==block.id&&(block.equation=block.links.u&&block.links.r&&!block.links.d&&!block.links.l?"dist2([x,y],["+(x*size+size)+","+y*size+"])>(size*.8)**2":!block.links.u&&block.links.r&&block.links.d&&!block.links.l?"dist2([x,y],["+(x*size+size)+","+(y*size+size)+"])>(size*.8)**2":!block.links.u&&!block.links.r&&block.links.d&&block.links.l?"dist2([x,y],["+x*size+","+(y*size+size)+"])>(size*.8)**2":block.links.u&&!block.links.r&&!block.links.d&&block.links.l?"dist2([x,y],["+
x*size+","+y*size+"])>(size*.8)**2":"false")},testcollision=function(a,g,e){g=$jscomp.makeIterator(g);x=g.next().value;y=g.next().value;z=g.next().value;try{e=space[x][y][z]}catch(c){}if(e)if(e.links.u||e.links.r||e.links.d||e.links.l){if("false"!=e.equation&&!oob||"false"==e.equation&&oob)oob=0;e.barriers.u&&e.flat.u&&a[1]%size<.2*size?collision=1:e.barriers.r&&e.flat.r&&a[0]%size>.8*size?(collision=1,speedduringcollision=carspeed):e.barriers.d&&e.flat.d&&a[1]%size>.8*size?(collision=1,speedduringcollision=
carspeed):e.barriers.l&&e.flat.l&&a[0]%size<.2*size?(collision=1,speedduringcollision=carspeed):"false"==e.equation||oob?"false"!=e.equation&&oob&&(a=$jscomp.makeIterator(a),x=a.next().value,y=a.next().value,z=a.next().value,ev=eval(e.equation),0==ev&&(collision=1,speedduringcollision=carspeed)):(a=$jscomp.makeIterator(a),x=a.next().value,y=a.next().value,z=a.next().value,ev=eval(e.equation),1==ev&&(collision=1,speedduringcollision=carspeed))}else oob=0;else oob=1};
editor=function(){var a=cursorx,g=cursory,e=gridz,c,f;for(i=0;i<gridrz/90;i++){var m=$jscomp.makeIterator([R,D,L,U]);U=m.next().value;R=m.next().value;D=m.next().value;L=m.next().value}L?cursorx--:R?cursorx++:U?cursory--:D&&cursory++;if(s){0<inventory[selected][2]&&!space[cursorx][cursory][gridz]&&(!space[cursorx][cursory][gridz+1]||space[cursorx][cursory][gridz+1]&&5!=inventory[selected][0]&&6!=inventory[selected][0]&&7!=inventory[selected][0]&&9!=inventory[selected][0])&&(roads.push([cursorx,cursory,
gridz,inventory[selected][0],0==inventory[selected][0]?0:cursorrz,0]),inventory[selected][2]--,C.$("qty"+selected).innerHTML=inventory[selected][2]+"/"+inventory[selected][1],draw_block(inventory[selected][0],"scene",cursorx,cursory,gridz,0,0==inventory[selected][0]?0:cursorrz,0));m=space[cursorx][cursory][gridz];var h,n;m.linkable.u&&((c=space[h=m.linkable.u[0]][f=m.linkable.u[1]][n=m.linkable.u[2]])&&c.surrogate_of&&(c=space[h=c.surrogate_of[0]][f=c.surrogate_of[1]][n=c.surrogate_of[2]]),!c||!c.linkable.d||
m.links.u||c.links.d||0==m.id&&0==c.id||roadlinks.push([[cursorx,cursory,gridz],[h,f,n]]));m.linkable.r&&((c=space[h=m.linkable.r[0]][f=m.linkable.r[1]][n=m.linkable.r[2]])&&c.surrogate_of&&(c=space[h=c.surrogate_of[0]][f=c.surrogate_of[1]][n=c.surrogate_of[2]]),!c||!c.linkable.l||m.links.r||c.links.l||0==m.id&&0==c.id||roadlinks.push([[cursorx,cursory,gridz],[h,f,n]]));m.linkable.d&&((c=space[h=m.linkable.d[0]][f=m.linkable.d[1]][n=m.linkable.d[2]])&&c.surrogate_of&&(c=space[h=c.surrogate_of[0]][f=
c.surrogate_of[1]][n=c.surrogate_of[2]]),!c||!c.linkable.u||m.links.d||c.links.u||0==m.id&&0==c.id||roadlinks.push([[cursorx,cursory,gridz],[h,f,n]]));m.linkable.l&&((c=space[h=m.linkable.l[0]][f=m.linkable.l[1]][n=m.linkable.l[2]])&&c.surrogate_of&&(c=space[h=c.surrogate_of[0]][f=c.surrogate_of[1]][n=c.surrogate_of[2]]),!c||!c.linkable.r||m.links.l||c.links.r||0==m.id&&0==c.id||roadlinks.push([[cursorx,cursory,gridz],[h,f,n]]));links();turns();c=$jscomp.makeIterator(roads);for(m=c.next();!m.done;m=
c.next())i=m.value,barriers(i)}else if(_&&space[cursorx][cursory][gridz]&&!space[cursorx][cursory][gridz].fixed){c=cursorx;h=cursory;f=gridz;space[c][h][f].surrogate_of&&(m=$jscomp.makeIterator(space[c][h][f].surrogate_of),c=m.next().value,h=m.next().value,f=m.next().value);if(space[c][h][f].surrogates)for(n=$jscomp.makeIterator(space[c][h][f].surrogates),m=n.next();!m.done;m=n.next())i=m.value,space[i[0]][i[1]][i[2]]=0;m=space[c][h][f].inventoryid;inventory[m][2]++;C.$("qty"+m).innerHTML=inventory[m][2]+
"/"+inventory[m][1];space[c][h][f].links.u&&(space[space[c][h][f].links.u[0]][space[c][h][f].links.u[1]][space[c][h][f].links.u[2]].links.d=0);space[c][h][f].links.r&&(space[space[c][h][f].links.r[0]][space[c][h][f].links.r[1]][space[c][h][f].links.r[2]].links.l=0);space[c][h][f].links.d&&(space[space[c][h][f].links.d[0]][space[c][h][f].links.d[1]][space[c][h][f].links.d[2]].links.u=0);space[c][h][f].links.l&&(space[space[c][h][f].links.l[0]][space[c][h][f].links.l[1]][space[c][h][f].links.l[2]].links.r=
0);space[c][h][f]=0;C.$("road-"+c+"-"+h+"-"+f).remove();for(i in roads)roads[i]&&roads[i][0]==c&&roads[i][1]==h&&roads[i][2]==f&&(roads[i]=0);for(i in roadlinks)for(j=0;2>j;j++)roadlinks[i]&&roadlinks[i][j][0]==c&&roadlinks[i][j][1]==h&&roadlinks[i][j][2]==f&&(roadlinks[i]=0);links();turns();c=$jscomp.makeIterator(roads);for(m=c.next();!m.done;m=c.next())(i=m.value)&&barriers(i)}if(rerender||L||R||U||D||S||_)C.camera({x:cursorx*size+size/2,y:cursory*size+size/2,z:400+gridz*sizeh,rz:gridrzreal,rx:40}),
C.move({n:"cursor",x:cursorx*size+size/2,y:cursory*size+size/2,z:gridz*sizeh}),rerender=0,cursor.style.background=space[cursorx][cursory][gridz]||0==inventory[selected][2]||space[cursorx][cursory][gridz+1]&&(5==inventory[selected][0]||6==inventory[selected][0]||7==inventory[selected][0]||9==inventory[selected][0])?"#e668":"#9f88";if(s)if(h=space[a][g][gridz],h.surrogate_of&&(e=$jscomp.makeIterator(h.surrogate_of),a=e.next().value,g=e.next().value,e=e.next().value,h=space[a][g][e]),m=cursorx,c=cursory,
f=gridz,n=space[m][c][f],n.surrogate_of&&(f=$jscomp.makeIterator(n.surrogate_of),m=f.next().value,c=f.next().value,f=f.next().value,n=space[m][c][f]),U){if(h&&n&&h.linkable.u&&n.linkable.d){roadlinks.push([[a,g,e],[m,c,f]]);links();turns();a=$jscomp.makeIterator(roads);for(m=a.next();!m.done;m=a.next())(i=m.value)&&barriers(i);equations()}}else if(R){if(h&&n&&h.linkable.r&&n.linkable.l){roadlinks.push([[a,g,e],[m,c,f]]);links();turns();a=$jscomp.makeIterator(roads);for(m=a.next();!m.done;m=a.next())(i=
m.value)&&barriers(i);equations()}}else if(D){if(h&&n&&h.linkable.d&&n.linkable.u){roadlinks.push([[a,g,e],[m,c,f]]);links();turns();a=$jscomp.makeIterator(roads);for(m=a.next();!m.done;m=a.next())(i=m.value)&&barriers(i);equations()}}else if(L&&h&&n&&h.linkable.l&&n.linkable.r){roadlinks.push([[a,g,e],[m,c,f]]);links();turns();a=$jscomp.makeIterator(roads);for(m=a.next();!m.done;m=a.next())(i=m.value)&&barriers(i);equations()}};
var select=function(a){inventory[a]&&(document.querySelector(".part.selected").classList.remove("selected"),C.$("part"+a).classList.add("selected"),selected=a,C.$("cursor").innerHTML="",draw_block(inventory[a][0],"cursor",.1,.1),rerender=1)},draw_block=function(a,g,e,c,f,m,h,n){var p="scene"==g?"road-"+e+"-"+c+"-"+f:"v"+g,w="block"+a;C.group({g:g,n:p,x:size*e+size/2,y:size*c+size/2,z:sizeh*f+1,o:"center",css:w,rx:m,rz:h});4>a&&C.plane({g:p,w:.8*size,h:.8*size,b:"#d90",o:"center",css:w});if(0==a)"scene"==
g&&(space[e][c][f]={fixed:n,free:0,id:a,inventoryid:selected,linkable:{u:[e,c-1,f],r:[e+1,c,f],d:[e,c+1,f],l:[e-1,c,f]},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:0,slope:0,angle:0,equation:"false"});else if(1==a)C.plane({g:p,w:.8*size,h:sizeh,z:sizeh/2,rx:-88,b:"linear-gradient(90deg, #666 5px, transparent 5px, transparent 75px, #666 75px),linear-gradient(#6c4 25px,transparent 25px)",o:"center",html:"start"}),"scene"==g&&(space[e][c][f]={fixed:n,
free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:0,slope:0,angle:h,equation:"false"},0==h?space[e][c][f].linkable.u=[e,c-1,f]:90==h?space[e][c][f].linkable.r=[e+1,c,f]:180==h?space[e][c][f].linkable.d=[e,c+1,f]:270==h&&(space[e][c][f].linkable.l=[e-1,c,f]));else if(2==a)C.plane({g:p,w:.8*size,h:sizeh,z:sizeh/2,rx:-88,b:"linear-gradient(90deg, #666 5px, transparent 5px, transparent 75px, #666 75px),linear-gradient(#d22 25px,transparent 25px)",
o:"center",html:"end"}),"scene"==g&&(space[e][c][f]={fixed:n,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:0,slope:0,angle:h,equation:"false"},0==h?space[e][c][f].linkable.d=[e,c+1,f]:90==h?space[e][c][f].linkable.l=[e-1,c,f]:180==h?space[e][c][f].linkable.u=[e,c-1,f]:270==h&&(space[e][c][f].linkable.r=[e+1,c,f]));else if(3==a)C.plane({g:p,w:.8*size,h:sizeh,z:sizeh/2,rx:-88,b:"linear-gradient(90deg, #666 5px, transparent 5px, transparent 75px, #666 75px),linear-gradient(#5ae 25px,transparent 25px)",
o:"center"}),"scene"==g&&(space[e][c][f]={fixed:n,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:0,slope:0,angle:h,equation:"false"},0==h?(space[e][c][f].linkable.u=[e,c-1,f],space[e][c][f].linkable.d=[e,c+1,f]):90==h?(space[e][c][f].linkable.r=[e+1,c,f],space[e][c][f].linkable.l=[e-1,c,f]):180==h?(space[e][c][f].linkable.u=[e,c-1,f],space[e][c][f].linkable.d=[e,c+1,f]):270==h&&(space[e][c][f].linkable.l=
[e-1,c,f],space[e][c][f].linkable.r=[e+1,c,f]));else if(4==a)C.plane({g:p,w:.8*size,h:.7*size,y:.2*size,z:sizeh/4,rx:-20,b:"#d00",o:"center"}),C.plane({g:p,w:.8*size,h:.2*size,y:-10,rx:-90,z:.2*sizeh,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",o:"center"}),"scene"==g&&(space[e][c][f]={fixed:n,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:0,slope:1,
angle:h,equation:"todo"},0==h?space[e][c][f].linkable.d=[e,c+1,f]:90==h?space[e][c][f].linkable.l=[e-1,c,f]:180==h?space[e][c][f].linkable.u=[e,c-1,f]:270==h&&(space[e][c][f].linkable.r=[e+1,c,f]));else if(5==a)C.plane({g:p,z:sizeh/2,w:.8*size,h:112,o:"center",b:"#d90",rx:-26.5}),C.plane({g:p,w:.8*size,h:40,y:-40,rx:-90,z:20,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",o:"center"}),"scene"==g&&(space[e][c][f]={fixed:n,free:0,id:a,inventoryid:selected,linkable:{u:0,
r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:[[e,c,f+1]],surrogate_of:0,slope:1,angle:h,equation:"todo"},0==h?(space[e][c][f].linkable.u=[e,c-1,f+1],space[e][c][f].linkable.d=[e,c+1,f]):90==h?(space[e][c][f].linkable.l=[e-1,c,f],space[e][c][f].linkable.r=[e+1,c,f+1]):180==h?(space[e][c][f].linkable.u=[e,c-1,f],space[e][c][f].linkable.d=[e,c+1,f+1]):270==h&&(space[e][c][f].linkable.l=[e-1,c,f+1],space[e][c][f].linkable.r=[e+1,c,f]),space[e][c][f+
1]={fixed:n,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:[e,c,f],slope:1,angle:h,equation:"todo"});else if(6==a){if(C.plane({g:p,w:.8*size,h:105,z:.36*sizeh,o:"center",b:"#d90",rx:-20}),C.plane({g:p,y:-size,z:.84*sizeh,w:.8*size,h:107,o:"center",b:"#d90",rx:-7}),C.plane({g:p,w:.8*size,h:sizeh,y:-size-40,rx:-90,z:.4*sizeh,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",
o:"center"}),C.plane({g:p,w:.8*size,h:.6*sizeh,y:-40,rx:-90,z:.3*sizeh,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",o:"center"}),"scene"==g){space[e][c][f]={fixed:n,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:[[e,c,f+1]],surrogate_of:0,slope:1,angle:h,equation:"todo"};var t,v,q;0==h?(space[e][c][f].linkable.u=[e,c-2,f+1],space[e][c][f].linkable.d=[e,c+1,f],space[e][c][f].surrogates.push([t=
e,v=c-1,q=f])):90==h?(space[e][c][f].linkable.l=[e-1,c,f],space[e][c][f].linkable.r=[e+2,c,f+1],space[e][c][f].surrogates.push([t=e+1,v=c,q=f])):180==h?(space[e][c][f].linkable.u=[e,c-1,f],space[e][c][f].linkable.d=[e,c+2,f+1],space[e][c][f].surrogates.push([t=e,v=c+1,q=f])):270==h&&(space[e][c][f].linkable.l=[e-2,c,f+1],space[e][c][f].linkable.r=[e+1,c,f],space[e][c][f].surrogates.push([t=e-1,v=c,q=f]));space[e][c][f].surrogates.push([t,v,q+1]);space[t][v][q]||space[t][v][q+1]?(C.$(p).remove(),space[e][c][f]=
0,cursor.style.background="#e668"):(space[t][v][q]={fixed:1,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:[e,c,f],slope:1,angle:h,equation:"todo"},space[e][c][f+1]={fixed:1,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:[e,c,f],slope:1,angle:h,equation:"todo"},space[t][v][q+
1]={fixed:1,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:[e,c,f],slope:1,angle:h,equation:"todo"})}}else if(7==a)C.plane({g:p,w:.8*size,h:105,z:6,o:"center",b:"#d90",rx:-7}),C.plane({g:p,y:-size,z:32,w:.8*size,h:107,o:"center",b:"#d90",rx:-20}),C.plane({g:p,w:.8*size,h:sizeh,y:-size-40,rx:-90,z:.4*sizeh,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",
o:"center"}),C.plane({g:p,w:.8*size,h:.2*sizeh,y:-40,rx:-90,z:.1*sizeh,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",o:"center"}),"scene"==g&&(space[e][c][f]={fixed:n,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:[[e,c,f+1]],surrogate_of:0,slope:1,angle:h,equation:"todo"},0==h?(space[e][c][f].linkable.u=[e,c-2,f+1],space[e][c][f].linkable.d=[e,c+1,f],space[e][c][f].surrogates.push([t=
e,v=c-1,q=f])):90==h?(space[e][c][f].linkable.l=[e-1,c,f],space[e][c][f].linkable.r=[e+2,c,f+1],space[e][c][f].surrogates.push([t=e+1,v=c,q=f])):180==h?(space[e][c][f].linkable.u=[e,c-1,f],space[e][c][f].linkable.d=[e,c+2,f+1],space[e][c][f].surrogates.push([t=e,v=c+1,q=f])):270==h&&(space[e][c][f].linkable.l=[e-2,c,f+1],space[e][c][f].linkable.r=[e+1,c,f],space[e][c][f].surrogates.push([t=e,v=c-1,q=f])),space[e][c][f].surrogates.push([t,v,q+1]),space[t][v][q]||space[t][v][q+1]?(C.$(p).remove(),space[e][c][f]=
0,cursor.style.background="#e668"):(space[t][v][q]={fixed:1,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:[e,c,f],slope:1,angle:h,equation:"todo"},space[e][c][f+1]={fixed:1,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:[e,c,f],slope:1,angle:h,equation:"todo"},space[t][v][q+
1]={fixed:1,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:[e,c,f],slope:1,angle:h,equation:"todo"}));else if(8==a)C.plane({g:p,z:1,w:.8*size,h:size,o:"center",css:"acc",rz:180}),"scene"==g&&(space[e][c][f]={fixed:n,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogate:0,slope:0,angle:h,equation:"false"},
0==h?(space[e][c][f].linkable.u=[e,c-1,f],space[e][c][f].linkable.d=[e,c+1,f]):90==h?(space[e][c][f].linkable.l=[e-1,c,f],space[e][c][f].linkable.r=[e+1,c,f]):180==h?(space[e][c][f].linkable.u=[e,c-1,f],space[e][c][f].linkable.d=[e,c+1,f]):270==h&&(space[e][c][f].linkable.l=[e-1,c,f],space[e][c][f].linkable.r=[e+1,c,f]));else if(9==a)C.plane({g:p,w:.8*size,h:112,z:sizeh/2,o:"center",css:"acc",rx:-26.5}),C.plane({g:p,w:.8*size,h:40,y:-40,rx:-90,z:20,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",
o:"center"}),"scene"==g&&(space[e][c][f]={fixed:n,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:[[e,c,f+1]],surrogate_of:0,slope:1,angle:h,equation:"todo"},0==h?(space[e][c][f].linkable.u=[e,c-1,f+1],space[e][c][f].linkable.d=[e,c+1,f]):90==h?(space[e][c][f].linkable.l=[e-1,c,f],space[e][c][f].linkable.r=[e+1,c,f+1]):180==h?(space[e][c][f].linkable.u=[e,c-1,f],space[e][c][f].linkable.d=[e,c+1,f+1]):
270==h&&(space[e][c][f].linkable.l=[e-1,c,f+1],space[e][c][f].linkable.r=[e+1,c,f]),space[e][c][f+1]={fixed:1,free:0,id:a,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:[e,c,f],slope:1,angle:h,equation:"todo"});else if(10==a)"scene"==g||"vcursor"==g?C.sprite({g:p,w:size,h:size,y:0,z:0,rx:-90,html:"\ud83c\udf32",css:"tree",o:"bottom"}):C.plane({g:p,w:size,h:size,y:0,z:0,rx:-90,html:"\ud83c\udf32",css:"tree",o:"bottom"}),
"scene"==g&&(space[e][c][f]={fixed:n,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:0,r:0,d:0,l:0},surrogates:0,surrogate_of:0,slope:0,angle:0,equation:"todo"},space[e][c][f+1]={fixed:n,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:0,r:0,d:0,l:0},surrogates:0,surrogate_of:0,slope:0,angle:0,equation:"todo"});else if(11==a&&(C.cube({g:p,w:100,h:sizeh*f+sizeh,
z:-sizeh*f,d:100,b:"#aaa",b2:"#777",b3:"#999"}),"scene"==g))for(q=0;q<=f;q++)space[e][c][q]={fixed:n,free:0,id:a,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:0,r:0,d:0,l:0},surrogates:0,surrogate_of:0,slope:0,angle:0,equation:"todo"};0<f&&4!=a&&0!=a&&11!=a&&(C.plane({g:p,w:.8*size,h:sizeh*f,y:-40,z:-f/2*sizeh,rx:-90,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",o:"center"}),C.plane({g:p,w:.8*size,h:sizeh*
f,y:40,z:-f/2*sizeh,rx:-90,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",o:"center"}))},init=function(a){for(i=0;20>i;i++)for(space[i]=[],j=0;20>j;j++)space[i][j]=[];b.innerHTML="<textarea id=deb rows=6 cols=99></textarea><div id=viewport><div id=camera><div id=scene>";if(1==mode){b.className="editor";b.innerHTML+="<div id=menu>Camera<br>\n    <div id=gridup>\u21d1</div> <div id=griddown>\u21d3</div> <div id=gridrl>\u21b6</div> <div id=gridrr>\u21b7</div><br>\u23af<br>Block<br><div id=blockrl>\u21b6</div> <div id=blockrr>\u21b7</div><br><br><p>Add: <b>space+wasd</b> Remove: <b>Del</b><br>Play: <b>Enter</b></p>\u23af<br><div id=blockc style=width:120px>Clear all</div>";
b.innerHTML+="<div id=parts>";for(i=0;12>i;i++)selected=0,parts.innerHTML+='<div class="part '+(0==i?"selected":"")+'" id=part'+i+" onclick=select("+i+")><div class=visual id=visual"+i+"></div><div class=remaining id=qty"+i+">";gridz=0;C.plane({n:"grid",w:20*size,h:20*size,o:"top left"});roads=[[5,10,0,1,0,1]];var g=$jscomp.makeIterator(roads);for(a=g.next();!a.done;a=g.next())if(i=a.value)draw_block(i[3],"scene",i[0],i[1],i[2],0,i[4],1),1==i[3]&&(cursorx=i[0],cursory=i[1],gridz=i[2]);roadlinks=[];
inventory=[[0,40,40],[1,1,1],[2,1,1],[3,20,20],[4,20,20],[5,20,20],[6,20,20],[7,20,20],[8,20,20],[9,20,20],[10,20,20],[11,20,20]];for(i in inventory)j=inventory[i],C.$("qty"+i).innerHTML=j[2]+"/"+j[1],draw_block(j[0],"visual"+i,6==j[0]||7==j[0]?-.7:-.5,6==j[0]||7==j[0]?-.2:-.4,6==j[0]||7==j[0]?-25:-15,50,30);C.group({n:"cursor",w:1.2*size,h:1.2*size,x:cursorx*size+size/2,y:cursory*size+size/2,z:gridz*sizeh,o:"center"});select(0);rerender=1;links();g=$jscomp.makeIterator(roads);for(a=g.next();!a.done;a=
g.next())(i=a.value)&&barriers(i);turns();equations()}else if(2==mode){b.className="race";C.camera({x:cx,y:cy,z:cz,rx:crx});C.group({n:"car",w:0,h:0,rz:90});C.cube({g:"car",b:"#a33",b2:"#922",b3:"#c44",w:4,d:2,h:.75,z:.4});C.cube({g:"car",b:"#a33",b2:"#922",b3:"#c44",w:2,d:2,h:.55,z:1.15});C.plane({g:"car",b:"#555",w:.8,h:.8,rx:90,x:1,y:1.1,z:.58,css:"circle"});C.plane({g:"car",b:"#555",w:.8,h:.8,rx:90,x:1,y:-1.1,z:.58,css:"circle"});C.plane({g:"car",b:"#555",w:.8,h:.8,rx:90,x:-1,y:1.1,z:.58,css:"circle"});
C.plane({g:"car",b:"#555",w:.8,h:.8,rx:90,x:-1,y:-1.1,z:.58,css:"circle"});C.plane({g:"car",b:"#555",w:.3,h:.78,rx:90,ry:90,x:1,y:.95,z:.58});C.plane({g:"car",b:"#555",w:.3,h:.78,rx:90,ry:90,x:1,y:-.95,z:.58});C.plane({g:"car",b:"#555",w:.3,h:.78,rx:90,ry:90,x:-1,y:.95,z:.58});C.plane({g:"car",b:"#555",w:.3,h:.78,rx:90,ry:90,x:-1,y:-.95,z:.58});roads=[[10,16,0]];g=$jscomp.makeIterator(roads);for(a=g.next();!a.done;a=g.next())if(i=a.value)space[i[0]][i[1]][i[2]]={fixed:1,free:0,id:i[3],linkable:{},
links:{},flat:{u:1,r:1,d:1,l:1},barriers:{u:0,r:0,d:0,l:0},surrogate:0,angle:i[4],u:0,r:0,d:0,l:0,equation:"false"},draw_block(i[3],"scene",i[0],i[1],i[2],0,i[4]);roadlinks=[[[11,10,0],[11,11,0]]];for(i=1;i<roads.length-1;i++)roads[i]&&roadlinks.push([roads[i],roads[i+1]]);links();g=$jscomp.makeIterator(roadlinks);for(a=g.next();!a.done;a=g.next())i=a.value,barriers(i[0]),barriers(i[1]);turns();equations()}};init();
onkeydown=onkeyup=function(a){return top["lurdl*d*l_ur*u*s$***"[(a.which+3)%20]]=top["LURDL*D*L_UR*U*S$***"[(a.which+3)%20]]=a.type[5]};gridup.onclick=function(){10>gridz&&gridz++;C.move({n:"grid",z:gridz*sizeh});C.move({n:"cursor",z:gridz*sizeh});rerender=1};griddown.onclick=function(){gridz&&gridz--;C.move({n:"grid",z:gridz*sizeh});C.move({n:"cursor",z:gridz*sizeh});rerender=1};gridrl.onclick=function(){0==gridrz&&(gridrz=360);gridrz-=90;gridrzreal-=90;C.camera({rz:gridrzreal})};
gridrr.onclick=function(){360==gridrz&&(gridrz=0);gridrz+=90;gridrzreal+=90;C.camera({rz:gridrzreal})};blockrl.onclick=function(){0==cursorrz&&(cursorrz=360);cursorrz-=90;cursorrzreal-=90;C.move({n:"cursor",rz:cursorrzreal})};blockrr.onclick=function(){360==cursorrz&&(cursorrz=0);cursorrz+=90;cursorrzreal+=90;C.move({n:"cursor",rz:cursorrzreal})};
setInterval(function(){1==mode&&editor();if(2==mode){for(times=0;5>times;times++){delog();log("oob",oob);u?(carspeed+=.002,carspeed>(oob?.2:.4)&&(carspeed=oob?.2:.4)):d?(carspeed-=.0015,carspeed<(oob?-.15:-.3)&&(carspeed=oob?-.15:-.3)):carspeed*=.99;if(l&&u||r&&d)carrz-=.7;else if(r&&u||l&&d)carrz+=.7;carx+=carspeed*Math.sin(toRadians(carrz));cary-=carspeed*Math.cos(toRadians(carrz));var a=[carx+2*Math.sin(toRadians(carrz)),cary-2*Math.cos(toRadians(carrz)),0],g=[carx+-2*Math.sin(toRadians(carrz)),
cary- -2*Math.cos(toRadians(carrz)),0];fcell=[~~(a[0]/size),~~(a[1]/size),0];bcell=[~~(g[0]/size),~~(g[1]/size),0];0<=carspeed?testcollision(a,fcell,fcellinfo):testcollision(g,bcell,bcellinfo);frontcell=fcell;backcell=bcell}collision&&(carspeed=0<=speedduringcollision?-.05:.05,collision-=.1,0>=collision&&(collision=0));C.camera({x:carx,y:cary,rz:-carrz});C.move({n:"car",x:carx,y:cary,rz:carrz+90})}S=_=U=L=D=R=0},33);</script>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:calibri;cursor:pointer;user-select:none;-moz-user-select:none}#viewport{width:100vw;height:100vh;background:#fff;overflow:hidden;position:relative;perspective:500px}#viewport *,.part *{transform-style:preserve-3d;box-sizing:border-box}#camera{width:0;height:0;position:absolute;top:50%;left:50%}.circle{border-radius:50%}#deb{position:fixed;top:0;left:0;z-index:2;top:-999px;font-size:10px}.plane{text-align:center;font-size:25px;line-height:20px}.block0.z0{border:1px solid #ddd}.barrierleftright.z0{border-left:5px solid #000;border-right:5px solid #000}.barriertopbottom.z0{border-top:5px solid #000;border-bottom:5px solid #000}#grid{background:linear-gradient(#888 2px,transparent 2px),linear-gradient(90deg,#888 2px,transparent 2px),#def8;background-size:100px 100px}#menu{position:fixed;left:0;top:0;text-align:center;width:145px;background:#fff;padding:5px;border:2px solid}#menu div{width:60px;display:inline-block;height:30px;border:2px solid #555;background:#eee;font-size:20px;margin:2px 0}#parts{position:fixed;bottom:0;text-align:center;width:100%}.part{width:60px;height:80px;border:2px solid #555;background:#ddd;display:inline-block;vertical-align:top;perspective:500px}.part.selected{background:#fff}.visual{height:30px;margin:25px 30px 0}.editor #scene{transition:.2s linear}p{text-align:left;background:#eee;margin:0 2px;padding:5px}#cursor{transition:.1s linear}.tree{font-size:90px;line-height:90px;text-align:center;transition:.2s linear}.acc{background:linear-gradient(70deg,transparent 75%,#fd3 75%) center center,linear-gradient(-70deg,#d90 75%,#fd3 75%) center center,#d90;background-size:26px 24px}