<body id=b><script>C={unit:"px",camX:0,camY:0,camZ:0,camRX:0,camRY:0,camRZ:0,sprite_count:0,sprites:[],plane_count:0,cube_count:0,options:{},$:e=>document.getElementById(e),init:e=>{e.css||(e.css=""),e.html||(e.html=""),e.g||(e.g="scene"),e.o||(e.o="center"),"bottom"==e.o&&(e.y-=e.h/2),e.w||(e.w=0),e.h||(e.h=0),e.x||(e.x=0),e.y||(e.y=0),e.z||(e.z=0),e.rx||(e.rx=0),e.ry||(e.ry=0),e.rz||(e.rz=0),e.sx||(e.sx=1),e.sy||(e.sy=1),e.sz||(e.sz=1),C.options[e.n]=e},group:e=>{e.d||0===e.d||(e.d=e.h),C.init(e),C.$(e.g).innerHTML+=`<div id="${e.n}"class="group ${e.css}"style="position:absolute;width:${e.w}${C.unit};height:${e.d}${C.unit};background:${e.b};transform:${C.tr(e)}">`},plane:e=>{e.n||(e.n=`plane${C.plane_count++}`),C.init(e),C.$(e.g).innerHTML+=`<div id="${e.n}"class="plane ${e.css}"style="position:absolute;width:${e.w}${C.unit};height:${e.h}${C.unit};background:${e.b};transform-origin:${e.o};transform:${C.tr(e)}">${e.html}`,C.camera()},sprite:e=>{e.n||(e.n=`sprite${C.sprite_count++}`),C.init(e),C.$(e.g).innerHTML+=`<div id="${e.n}"class="sprite ${e.css}"style="position:absolute;width:${e.w}${C.unit};height:${e.h}${C.unit};background:${e.b};transform-origin:${e.o};transform:${C.tr(e)}">${e.html}`,C.sprites.push(e.n),C.camera()},cube:e=>{e.n||(e.n=`cube${C.cube_count++}`),C.init(e),C.group(e),C.plane({g:e.n,x:e.w/2,y:e.d/2,w:e.w,h:e.d,b:e.b,css:"bottom"}),C.plane({g:e.n,y:e.d/2,w:e.d,h:e.h,b:e.b,rx:-90,ry:-90,o:"bottom",css:"left"}),C.plane({g:e.n,x:e.w,y:e.d/2,w:e.d,h:e.h,b:e.b3,rx:-90,ry:-90,o:"bottom",css:"right"}),C.plane({g:e.n,x:e.w/2,y:0,w:e.w,h:e.h,b:e.b2,rx:-90,o:"bottom",css:"back"}),C.plane({g:e.n,x:e.w/2,y:e.d,w:e.w,h:e.h,b:e.b2,rx:-90,o:"bottom",css:"front"}),C.plane({g:e.n,x:e.w/2,y:e.d/2,z:e.h,w:e.w,h:e.d,b:e.b,css:"top"})},camera:e=>{for(var r in e&&(e.x||0===e.x)&&(C.camX=e.x),e&&(e.y||0===e.y)&&(C.camY=e.y),e&&(e.z||0===e.z)&&(C.camZ=e.z),e&&(e.rx||0===e.rx)&&(C.camRX=e.rx),e&&(e.ry||0===e.ry)&&(C.camRY=e.ry),e&&(e.rz||0===e.rz)&&(C.camRZ=e.rz),C.camX+=(Math.random()-.5)/1e3,scene.style.transformOrigin=`${C.camX}${C.unit} ${C.camY}${C.unit}`,scene.style.transform=`translateX(${-C.camX}${C.unit})translateY(${-C.camY}${C.unit})translateZ(${-C.camZ}${C.unit})rotateX(${C.camRX}deg)rotateY(${C.camRY}deg)rotateZ(${C.camRZ}deg)`,C.sprites){var l=C.$(C.sprites[r]),i=l.style.transform.replace(/ *rotate.*\(.*?deg\)/g,"");l.style.transform=i+`rotateZ(${-C.camRZ}deg)rotateX(${-C.camRX}deg)`}},move:e=>{if(e.n){var r=C.$(e.n),l=C.options[e.n];(e.x||0===e.x)&&(l.x=e.x),(e.y||0===e.y)&&(l.y=e.y),(e.z||0===e.z)&&(l.z=e.z),(e.rx||0===e.rx)&&(l.rx=e.rx),(e.ry||0===e.ry)&&(l.ry=e.ry),(e.rz||0===e.rz)&&(l.rz=e.rz),C.options[e.n]=l,r.style.transform=C.tr(l)}},tr:e=>`${"top left"==e.o?"":"translateX(-50%)translateY(-50%)"}translateX(${e.x}${C.unit})translateY(${e.y}${C.unit})translateZ(${e.z}${C.unit})rotateX(${e.rx}deg)rotateY(${e.ry}deg)rotateZ(${e.rz}deg)`};var mode=1,world=0,puzzle=0,race=0,size=100,sizeh=50,s=0,u=0,l=0,d=0,r=0,S=0,U=0,L=0,D=0,R=0,_=0,$=0,cx=25,cy=25,cz=30,crx=55,cry=0,crz=0,carx=10*size+size/2,cary=16*size+size/2,carrz=0,carspeed=0,front=[0,0,0],back=[0,0,0],frontcell=[0,0],backcell=[0,0],oob=0,collision=0,speedduringcollision=0,fcell,bcell,fcellinfo,bcellinfo,space=[],roads=[],roadlinks=[],gridz=0,gridrz=0,gridrzreal=0,cursorx=0,cursory=0,cursorrz=0,cursorrzreal=0,selected=0,rerender=0,inventory=[],ev,i,j,k,x,y,z,block,times,toRadians=e=>e*(Math.PI/180),dist2=(e,r)=>(e[0]-r[0])**2+(e[1]-r[1])**2,delog=()=>deb.innerHTML="",log=(...e)=>deb.innerHTML+=e+"\n",barriers=e=>{if([x,y,z]=e,0==z&&(block=space[x][y][z])){for(var r="u",l="r",i="d",s="l",o=0;o<block.angle;o+=90)[r,l,i,s]=[l,i,s,r];0==block.id?(C.$(`road-${x}-${y}-${z}`).children[0].style.border="0",block.barriers={u:0,r:0,d:0,l:0},(block.links.u||block.links.r||block.links.d||block.links.l)&&(block.links[r]||block.links[i]?block.links[s]||block.links[l]?block.links[r]&&block.links[s]&&!block.links[l]&&!block.links[i]?(block.barriers[l]=1,block.barriers[i]=1):block.links[r]&&!block.links[s]&&block.links[l]&&!block.links[i]?(block.barriers[s]=1,block.barriers[i]=1):!block.links[r]&&block.links[s]&&!block.links[l]&&block.links[i]&&(block.barriers[l]=1,block.barriers[r]=1):(block.barriers[s]=1,block.barriers[l]=1):(block.barriers[r]=1,block.barriers[i]=1),!block.links[r]&&!block.links[s]&&block.links[l]&&block.links[i]?(block.barriers[r]=1,block.barriers[s]=1):block.links[r]&&block.links[l]&&block.links[i]&&!block.links[s]?block.barriers[s]=1:block.links[r]&&block.links[l]&&!block.links[i]&&block.links[s]?block.barriers[i]=1:block.links[r]&&!block.links[l]&&block.links[i]&&block.links[s]?block.barriers[l]=1:!block.links[r]&&block.links[l]&&block.links[i]&&block.links[s]&&(block.barriers[r]=1))):1==block.id?(C.$(`road-${x}-${y}-${z}`).children[0].style.border="0",block.barriers={u:1,r:1,d:1,l:1},0==block.angle&&block.links.u&&(block.barriers.u=0),90==block.angle&&block.links.r&&(block.barriers.r=0),180==block.angle&&block.links.d&&(block.barriers.d=0),270==block.angle&&block.links.l&&(block.barriers.l=0)):2==block.id?(C.$(`road-${x}-${y}-${z}`).children[0].style.border="0",block.barriers={u:1,r:1,d:1,l:1},0==block.angle&&block.links.d&&(block.barriers.d=0),90==block.angle&&block.links.l&&(block.barriers.l=0),180==block.angle&&block.links.u&&(block.barriers.u=0),270==block.angle&&block.links.r&&(block.barriers.r=0)):3==block.id?(C.$(`road-${x}-${y}-${z}`).children[0].style.border="0",block.barriers={u:1,r:1,d:1,l:1},0==block.angle&&block.links.d&&(block.barriers.u=0,block.barriers.d=0),90==block.angle&&block.links.l&&(block.barriers.l=0,block.barriers.r=0),180==block.angle&&block.links.u&&(block.barriers.u=0,block.barriers.d=0),270==block.angle&&block.links.r&&(block.barriers.l=0,block.barriers.r=0)):4==block.id?(C.$(`road-${x}-${y}-${z}`).children[0].style.border="0",block.barriers={u:0,r:0,d:0,l:0},0!=block.angle||block.links.d||(block.barriers.d=1),90!=block.angle||block.links.l||(block.barriers.l=1),180!=block.angle||block.links.u||(block.barriers.u=1),270!=block.angle||block.links.r||(block.barriers.r=1)):5==block.id?(C.$(`road-${x}-${y}-${z}`).children[0].style.border="0",block.barriers={u:0,r:0,d:0,l:0},0!=block.angle||block.links.d||(block.barriers.d=1),90!=block.angle||block.links.l||(block.barriers.l=1),180!=block.angle||block.links.u||(block.barriers.u=1),270!=block.angle||block.links.r||(block.barriers.r=1)):6==block.id?(C.$(`road-${x}-${y}-${z}`).children[0].style.border="0",block.barriers={u:0,r:0,d:0,l:0},0!=block.angle||block.links.d||(block.barriers.d=1),90!=block.angle||block.links.l||(block.barriers.l=1),180!=block.angle||block.links.u||(block.barriers.u=1),270!=block.angle||block.links.r||(block.barriers.r=1)):7==block.id?(C.$(`road-${x}-${y}-${z}`).children[0].style.border="0",block.barriers={u:0,r:0,d:0,l:0},0!=block.angle||block.links.d||(block.barriers.d=1),90!=block.angle||block.links.l||(block.barriers.l=1),180!=block.angle||block.links.u||(block.barriers.u=1),270!=block.angle||block.links.r||(block.barriers.r=1)):8==block.id?(C.$(`road-${x}-${y}-${z}`).children[0].style.border="0",block.barriers={u:1,r:1,d:1,l:1},0==block.angle&&block.links.d&&(block.barriers.u=0,block.barriers.d=0),90==block.angle&&block.links.l&&(block.barriers.l=0,block.barriers.r=0),180==block.angle&&block.links.u&&(block.barriers.u=0,block.barriers.d=0),270==block.angle&&block.links.r&&(block.barriers.l=0,block.barriers.r=0)):9==block.id&&(C.$(`road-${x}-${y}-${z}`).children[0].style.border="0",block.barriers={u:0,r:0,d:0,l:0},0!=block.angle||block.links.d||(block.barriers.d=1),90!=block.angle||block.links.l||(block.barriers.l=1),180!=block.angle||block.links.u||(block.barriers.u=1),270!=block.angle||block.links.r||(block.barriers.r=1)),block.barriers[r]&&(C.$(`road-${x}-${y}-${z}`).children[0].style.borderTop="5px solid #000"),block.barriers[i]&&(C.$(`road-${x}-${y}-${z}`).children[0].style.borderBottom="5px solid #000"),block.barriers[s]&&(C.$(`road-${x}-${y}-${z}`).children[0].style.borderLeft="5px solid #000"),block.barriers[l]&&(C.$(`road-${x}-${y}-${z}`).children[0].style.borderRight="5px solid #000")}},links=()=>{for(j of document.querySelectorAll(".barrierleftright,.barriertopbottom"))j.remove();for(i of roadlinks)if(i[0]){var e=space[i[0][0]][i[0][1]][i[0][2]],r=space[i[1][0]][i[1][1]][i[1][2]];i[0][0]==i[1][0]&&i[0][1]<i[1][1]&&(e.slope||r.slope?e.slope&&!r.slope?C.plane({n:1,w:.8*size,h:.1*size,x:i[1][0]*size+.1*size,y:i[1][1]*size+1*size-size,z:sizeh*i[1][2]+1,b:"#d90",o:"top left",css:`barrierleftright ${0==i[1][2]?"z0":""}`}):!e.slope&&r.slope&&C.plane({n:2,w:.8*size,h:.1*size,x:i[0][0]*size+.1*size,y:i[0][1]*size+.9*size,z:sizeh*i[0][2]+1,b:"#d90",o:"top left",css:`barrierleftright ${0==i[0][2]?"z0":""}`}):C.plane({n:"zer0",w:.8*size,h:.2*size,x:i[0][0]*size+.1*size,y:i[0][1]*size+.9*size,z:sizeh*i[0][2]+1,b:"#d90",o:"top left",css:`barrierleftright ${0==i[0][2]?"z0":""}`}),e.links.d=[i[1][0],i[1][1],i[1][2]],r.links.u=[i[0][0],i[0][1],i[0][2]]),i[0][0]==i[1][0]&&i[0][1]>i[1][1]&&(e.slope||r.slope?e.slope&&!r.slope?C.plane({n:11,w:.8*size,h:.1*size,x:i[1][0]*size+.1*size,y:i[1][1]*size+.9*size,z:sizeh*i[1][2]+1,b:"#d90",o:"top left",css:`barrierleftright ${0==i[1][2]?"z0":""}`}):!e.slope&&r.slope&&C.plane({n:12,w:.8*size,h:.1*size,x:i[1][0]*size+.1*size,y:i[1][1]*size+size,z:sizeh*i[1][2]+1,b:"#d90",o:"top left",css:`barrierleftright ${0==i[1][2]?"z0":""}`}):C.plane({n:10,w:.8*size,h:.2*size,x:i[1][0]*size+.1*size,y:i[1][1]*size+.9*size,z:sizeh*i[1][2]+1,b:"#d90",o:"top left",css:`barrierleftright ${0==i[1][2]?"z0":""}`}),e.links.u=[i[1][0],i[1][1],i[1][2]],r.links.d=[i[0][0],i[0][1],i[0][2]]),i[0][0]<i[1][0]&&i[0][1]==i[1][1]&&(e.slope||r.slope?e.slope&&!r.slope?C.plane({n:21,w:.1*size,h:.8*size,x:i[1][0]*size,y:i[1][1]*size+.1*size,z:sizeh*i[1][2]+1,b:"#d90",o:"top left",css:`barriertopbottom ${0==i[1][2]?"z0":""}`}):!e.slope&&r.slope&&C.plane({n:22,w:.1*size,h:.8*size,x:i[0][0]*size+.9*size,y:i[0][1]*size+.1*size,z:sizeh*i[0][2]+1,b:"#d90",o:"top left",css:`barriertopbottom ${0==i[0][2]?"z0":""}`}):C.plane({n:20,w:.2*size,h:.8*size,x:i[0][0]*size+.9*size,y:i[1][1]*size+.1*size,z:sizeh*i[0][2]+1,b:"#d90",o:"top left",css:`barriertopbottom ${0==i[0][2]?"z0":""}`}),e.links.r=[i[1][0],i[1][1],i[1][2]],r.links.l=[i[0][0],i[0][1],i[0][2]]),i[0][0]>i[1][0]&&i[0][1]==i[1][1]&&(e.slope||r.slope?e.slope&&!r.slope?C.plane({n:31,w:.1*size,h:.8*size,x:i[1][0]*size+.9*size,y:i[1][1]*size+.1*size,z:sizeh*i[1][2]+1,b:"#d90",o:"top left",css:`barriertopbottom ${0==i[1][2]?"z0":""}`}):!e.slope&&r.slope&&C.plane({n:32,w:.1*size,h:.8*size,x:i[0][0]*size,y:i[0][1]*size+.1*size,z:sizeh*i[0][2]+1,b:"#d90",o:"top left",css:`barriertopbottom ${0==i[0][2]?"z0":""}`}):C.plane({n:30,w:.2*size,h:.8*size,x:i[1][0]*size+.9*size,y:i[1][1]*size+.1*size,z:sizeh*i[1][2]+1,b:"#d90",o:"top left",css:`barriertopbottom ${0==i[1][2]?"z0":""}`}),e.links.l=[i[1][0],i[1][1],i[1][2]],r.links.r=[i[0][0],i[0][1],i[0][2]])}},turns=()=>{for(i of roads)i&&([x,y,z]=i,(block=space[x][y][z])&&0==block.id&&(block.flat={u:1,r:1,d:1,l:1},block.links.u&&block.links.r&&!block.links.d&&!block.links.l?(C.$(`road-${x}-${y}-${z}`).children[0].style.borderRadius="0 0 0 100%",block.flat.d=0,block.flat.l=0):!block.links.u&&block.links.r&&block.links.d&&!block.links.l?(C.$(`road-${x}-${y}-${z}`).children[0].style.borderRadius="100% 0 0 0",block.flat.u=0,block.flat.l=0):!block.links.u&&!block.links.r&&block.links.d&&block.links.l?(C.$(`road-${x}-${y}-${z}`).children[0].style.borderRadius="0 100% 0 0",block.flat.u=0,block.flat.r=0):block.links.u&&!block.links.r&&!block.links.d&&block.links.l?(C.$(`road-${x}-${y}-${z}`).children[0].style.borderRadius="0 0 100% 0",block.flat.d=0,block.flat.r=0):C.$(`road-${x}-${y}-${z}`)&&(C.$(`road-${x}-${y}-${z}`).children[0].style.borderRadius="0",block.flat.u=0,block.flat.r=0,block.flat.d=0,block.flat.l=0)))},equations=()=>{for(i of roads)i&&([x,y,z]=i,(block=space[x][y][z])&&0==block.id&&(block.links.u&&block.links.r&&!block.links.d&&!block.links.l?block.equation=`dist2([x,y],[${x*size+size},${y*size}])>(size*.8)**2`:!block.links.u&&block.links.r&&block.links.d&&!block.links.l?block.equation=`dist2([x,y],[${x*size+size},${y*size+size}])>(size*.8)**2`:!block.links.u&&!block.links.r&&block.links.d&&block.links.l?block.equation=`dist2([x,y],[${x*size},${y*size+size}])>(size*.8)**2`:block.links.u&&!block.links.r&&!block.links.d&&block.links.l?block.equation=`dist2([x,y],[${x*size},${y*size}])>(size*.8)**2`:block.equation="false"))},testcollision=(f,fcell,fcellinfo)=>{[x,y,z]=fcell;try{fcellinfo=space[x][y][z]}catch(e){}fcellinfo?fcellinfo.links.u||fcellinfo.links.r||fcellinfo.links.d||fcellinfo.links.l?(("false"!=fcellinfo.equation&&!oob||"false"==fcellinfo.equation&&oob)&&(oob=0),fcellinfo.barriers.u&&fcellinfo.flat.u&&f[1]%size<.2*size?collision=1:fcellinfo.barriers.r&&fcellinfo.flat.r&&f[0]%size>.8*size?(collision=1,speedduringcollision=carspeed):fcellinfo.barriers.d&&fcellinfo.flat.d&&f[1]%size>.8*size?(collision=1,speedduringcollision=carspeed):fcellinfo.barriers.l&&fcellinfo.flat.l&&f[0]%size<.2*size?(collision=1,speedduringcollision=carspeed):"false"==fcellinfo.equation||oob?"false"!=fcellinfo.equation&&oob&&([x,y,z]=f,ev=eval(fcellinfo.equation),0==ev&&(collision=1,speedduringcollision=carspeed)):([x,y,z]=f,ev=eval(fcellinfo.equation),1==ev&&(collision=1,speedduringcollision=carspeed))):oob=0:oob=1};editor=(()=>{var e,r,l,o=cursorx,a=cursory,n=gridz;for(i=0;i<gridrz/90;i++)[U,R,D,L]=[R,D,L,U];if(L?cursorx--:R?cursorx++:U?cursory--:D&&cursory++,s){inventory[selected][2]>0&&!space[cursorx][cursory][gridz]&&(!space[cursorx][cursory][gridz+1]||space[cursorx][cursory][gridz+1]&&5!=inventory[selected][0]&&6!=inventory[selected][0]&&7!=inventory[selected][0]&&9!=inventory[selected][0])&&(roads.push([cursorx,cursory,gridz,inventory[selected][0],0==inventory[selected][0]?0:cursorrz,0]),inventory[selected][2]--,C.$(`qty${selected}`).innerHTML=inventory[selected][2]+"/"+inventory[selected][1],draw_block(inventory[selected][0],"scene",cursorx,cursory,gridz,0,0==inventory[selected][0]?0:cursorrz,0));var c,d,t,b,k=space[cursorx][cursory][gridz];for(i of(k.linkable.u&&((c=space[d=k.linkable.u[0]][t=k.linkable.u[1]][b=k.linkable.u[2]])&&c.surrogate_of&&(c=space[d=c.surrogate_of[0]][t=c.surrogate_of[1]][b=c.surrogate_of[2]]),!c||!c.linkable.d||k.links.u||c.links.d||0==k.id&&0==c.id||roadlinks.push([[cursorx,cursory,gridz],[d,t,b]])),k.linkable.r&&((c=space[d=k.linkable.r[0]][t=k.linkable.r[1]][b=k.linkable.r[2]])&&c.surrogate_of&&(c=space[d=c.surrogate_of[0]][t=c.surrogate_of[1]][b=c.surrogate_of[2]]),!c||!c.linkable.l||k.links.r||c.links.l||0==k.id&&0==c.id||roadlinks.push([[cursorx,cursory,gridz],[d,t,b]])),k.linkable.d&&((c=space[d=k.linkable.d[0]][t=k.linkable.d[1]][b=k.linkable.d[2]])&&c.surrogate_of&&(c=space[d=c.surrogate_of[0]][t=c.surrogate_of[1]][b=c.surrogate_of[2]]),!c||!c.linkable.u||k.links.d||c.links.u||0==k.id&&0==c.id||roadlinks.push([[cursorx,cursory,gridz],[d,t,b]])),k.linkable.l&&((c=space[d=k.linkable.l[0]][t=k.linkable.l[1]][b=k.linkable.l[2]])&&c.surrogate_of&&(c=space[d=c.surrogate_of[0]][t=c.surrogate_of[1]][b=c.surrogate_of[2]]),!c||!c.linkable.r||k.links.l||c.links.r||0==k.id&&0==c.id||roadlinks.push([[cursorx,cursory,gridz],[d,t,b]])),links(),turns(),roads))barriers(i)}else if(_&&space[cursorx][cursory][gridz]&&!space[cursorx][cursory][gridz].fixed){var u=cursorx,p=cursory,z=gridz;if(space[u][p][z].surrogate_of&&([u,p,z]=space[u][p][z].surrogate_of),space[u][p][z].surrogates)for(i of space[u][p][z].surrogates)space[i[0]][i[1]][i[2]]=0;var g=space[u][p][z].inventoryid;for(i in inventory[g][2]++,C.$(`qty${g}`).innerHTML=inventory[g][2]+"/"+inventory[g][1],space[u][p][z].links.u&&(space[space[u][p][z].links.u[0]][space[u][p][z].links.u[1]][space[u][p][z].links.u[2]].links.d=0),space[u][p][z].links.r&&(space[space[u][p][z].links.r[0]][space[u][p][z].links.r[1]][space[u][p][z].links.r[2]].links.l=0),space[u][p][z].links.d&&(space[space[u][p][z].links.d[0]][space[u][p][z].links.d[1]][space[u][p][z].links.d[2]].links.u=0),space[u][p][z].links.l&&(space[space[u][p][z].links.l[0]][space[u][p][z].links.l[1]][space[u][p][z].links.l[2]].links.r=0),space[u][p][z]=0,C.$(`road-${u}-${p}-${z}`).remove(),roads)roads[i]&&roads[i][0]==u&&roads[i][1]==p&&roads[i][2]==z&&(roads[i]=0);for(i in roadlinks)for(j=0;j<2;j++)roadlinks[i]&&roadlinks[i][j][0]==u&&roadlinks[i][j][1]==p&&roadlinks[i][j][2]==z&&(roadlinks[i]=0);for(i of(links(),turns(),roads))i&&barriers(i)}if((rerender||L||R||U||D||S||_)&&(C.camera({x:cursorx*size+size/2,y:cursory*size+size/2,z:400+gridz*sizeh,rz:gridrzreal,rx:40}),C.move({n:"cursor",x:cursorx*size+size/2,y:cursory*size+size/2,z:gridz*sizeh}),rerender=0,space[cursorx][cursory][gridz]||0==inventory[selected][2]||space[cursorx][cursory][gridz+1]&&(5==inventory[selected][0]||6==inventory[selected][0]||7==inventory[selected][0]||9==inventory[selected][0])?cursor.style.background="#e668":cursor.style.background="#9f88"),s){var f=space[o][a][gridz];f.surrogate_of&&([o,a,n]=f.surrogate_of,f=space[o][a][n]),r=cursory,l=gridz;var x=space[e=cursorx][r][l];if(x.surrogate_of&&([e,r,l]=x.surrogate_of,x=space[e][r][l]),U){if(f&&x&&f.linkable.u&&x.linkable.d){for(i of(roadlinks.push([[o,a,n],[e,r,l]]),links(),turns(),roads))i&&barriers(i);equations()}}else if(R){if(f&&x&&f.linkable.r&&x.linkable.l){for(i of(roadlinks.push([[o,a,n],[e,r,l]]),links(),turns(),roads))i&&barriers(i);equations()}}else if(D){if(f&&x&&f.linkable.d&&x.linkable.u){for(i of(roadlinks.push([[o,a,n],[e,r,l]]),links(),turns(),roads))i&&barriers(i);equations()}}else if(L&&f&&x&&f.linkable.l&&x.linkable.r){for(i of(roadlinks.push([[o,a,n],[e,r,l]]),links(),turns(),roads))i&&barriers(i);equations()}}});var select=e=>{inventory[e]&&(document.querySelector(".part.selected").classList.remove("selected"),C.$("part"+e).classList.add("selected"),selected=e,C.$("cursor").innerHTML="",draw_block(inventory[e][0],"cursor",.1,.1),rerender=1)},init=e=>{for(i=0;i<20;i++)for(space[i]=[],j=0;j<20;j++)space[i][j]=[];if(b.innerHTML="<textarea id=deb rows=6 cols=99></textarea><div id=viewport><div id=camera><div id=scene>",1==mode){for(b.className="editor",b.innerHTML+="<div id=menu>Camera<br>\n    <div id=gridup>⇑</div> <div id=griddown>⇓</div> <div id=gridrl>↶</div> <div id=gridrr>↷</div><br>⎯<br>Block<br><div id=blockrl>↶</div> <div id=blockrr>↷</div><br><br><p>Add: <b>space+wasd</b> Remove: <b>Del</b><br>Play: <b>Enter</b></p>⎯<br><div id=blockc style=width:120px>Clear all</div>",b.innerHTML+="<div id=parts>",i=0;i<12;i++)selected=0,parts.innerHTML+=`<div class="part ${0==i?"selected":""}" id=part${i} onclick=select(${i})><div class=visual id=visual${i}></div><div class=remaining id=qty${i}>`;for(i of(gridz=0,C.plane({n:"grid",w:20*size,h:20*size,o:"top left"}),roads=[[5,10,0,1,0,1]]))i&&(draw_block(i[3],"scene",i[0],i[1],i[2],0,i[4],1),1==i[3]&&(cursorx=i[0],cursory=i[1],gridz=i[2]));for(i in roadlinks=[],inventory=[[0,40,40],[1,1,1],[2,1,1],[3,20,20],[4,20,20],[5,20,20],[6,20,20],[7,20,20],[8,20,20],[9,20,20],[10,20,20],[11,20,20]])j=inventory[i],C.$(`qty${i}`).innerHTML=`${j[2]}/${j[1]}`,draw_block(j[0],`visual${i}`,6==j[0]||7==j[0]?-.7:-.5,6==j[0]||7==j[0]?-.2:-.4,6==j[0]||7==j[0]?-25:-15,50,30);for(i of(C.group({n:"cursor",w:1.2*size,h:1.2*size,x:cursorx*size+size/2,y:cursory*size+size/2,z:gridz*sizeh,o:"center"}),select(0),rerender=1,links(),roads))i&&barriers(i);turns(),equations()}else if(2==mode){for(i of(b.className="race",C.camera({x:cx,y:cy,z:cz,rx:crx}),C.group({n:"car",w:0,h:0,rz:90}),C.cube({g:"car",b:"#a33",b2:"#922",b3:"#c44",w:4,d:2,h:.75,z:.4}),C.cube({g:"car",b:"#a33",b2:"#922",b3:"#c44",w:2,d:2,h:.55,z:1.15}),C.plane({g:"car",b:"#555",w:.8,h:.8,rx:90,x:1,y:1.1,z:.58,css:"circle"}),C.plane({g:"car",b:"#555",w:.8,h:.8,rx:90,x:1,y:-1.1,z:.58,css:"circle"}),C.plane({g:"car",b:"#555",w:.8,h:.8,rx:90,x:-1,y:1.1,z:.58,css:"circle"}),C.plane({g:"car",b:"#555",w:.8,h:.8,rx:90,x:-1,y:-1.1,z:.58,css:"circle"}),C.plane({g:"car",b:"#555",w:.3,h:.78,rx:90,ry:90,x:1,y:.95,z:.58}),C.plane({g:"car",b:"#555",w:.3,h:.78,rx:90,ry:90,x:1,y:-.95,z:.58}),C.plane({g:"car",b:"#555",w:.3,h:.78,rx:90,ry:90,x:-1,y:.95,z:.58}),C.plane({g:"car",b:"#555",w:.3,h:.78,rx:90,ry:90,x:-1,y:-.95,z:.58}),roads=[[10,16,0]]))i&&(space[i[0]][i[1]][i[2]]={fixed:1,free:0,id:i[3],linkable:{},links:{},flat:{u:1,r:1,d:1,l:1},barriers:{u:0,r:0,d:0,l:0},surrogate:0,angle:i[4],u:0,r:0,d:0,l:0,equation:"false"},draw_block(i[3],"scene",i[0],i[1],i[2],0,i[4]));for(roadlinks=[[[11,10,0],[11,11,0]]],i=1;i<roads.length-1;i++)roads[i]&&roadlinks.push([roads[i],roads[i+1]]);for(i of(links(),roadlinks))barriers(i[0]),barriers(i[1]);turns(),equations()}};init(),onkeydown=onkeyup=(e=>top["lurdl*d*l_ur*u*s$***"[(e.which+3)%20]]=top["LURDL*D*L_UR*U*S$***"[(e.which+3)%20]]=e.type[5]),gridup.onclick=(()=>{gridz<10&&gridz++,C.move({n:"grid",z:gridz*sizeh}),C.move({n:"cursor",z:gridz*sizeh}),rerender=1}),griddown.onclick=(()=>{gridz&&gridz--,C.move({n:"grid",z:gridz*sizeh}),C.move({n:"cursor",z:gridz*sizeh}),rerender=1}),gridrl.onclick=(()=>{0==gridrz&&(gridrz=360),gridrz-=90,gridrzreal-=90,C.camera({rz:gridrzreal})}),gridrr.onclick=(()=>{360==gridrz&&(gridrz=0),gridrz+=90,gridrzreal+=90,C.camera({rz:gridrzreal})}),blockrl.onclick=(()=>{0==cursorrz&&(cursorrz=360),cursorrz-=90,cursorrzreal-=90,C.move({n:"cursor",rz:cursorrzreal})}),blockrr.onclick=(()=>{360==cursorrz&&(cursorrz=0),cursorrz+=90,cursorrzreal+=90,C.move({n:"cursor",rz:cursorrzreal})});var draw_block=(e,r,l,i,s,o,a,n)=>{var c="scene"==r?`road-${l}-${i}-${s}`:`v${r}`,d=`block${e}`;if(C.group({g:r,n:c,x:size*l+size/2,y:size*i+size/2,z:sizeh*s+1,o:"center",css:d,rx:o,rz:a}),e<4&&C.plane({g:c,w:.8*size,h:.8*size,b:"#d90",o:"center",css:d}),0==e)"scene"==r&&(space[l][i][s]={fixed:n,free:0,id:e,inventoryid:selected,linkable:{u:[l,i-1,s],r:[l+1,i,s],d:[l,i+1,s],l:[l-1,i,s]},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:0,slope:0,angle:0,equation:"false"});else if(1==e)C.plane({g:c,w:.8*size,h:sizeh,z:sizeh/2,rx:-88,b:"linear-gradient(90deg, #666 5px, transparent 5px, transparent 75px, #666 75px),linear-gradient(#6c4 25px,transparent 25px)",o:"center",html:"start"}),"scene"==r&&(space[l][i][s]={fixed:n,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:0,slope:0,angle:a,equation:"false"},0==a?space[l][i][s].linkable.u=[l,i-1,s]:90==a?space[l][i][s].linkable.r=[l+1,i,s]:180==a?space[l][i][s].linkable.d=[l,i+1,s]:270==a&&(space[l][i][s].linkable.l=[l-1,i,s]));else if(2==e)C.plane({g:c,w:.8*size,h:sizeh,z:sizeh/2,rx:-88,b:"linear-gradient(90deg, #666 5px, transparent 5px, transparent 75px, #666 75px),linear-gradient(#d22 25px,transparent 25px)",o:"center",html:"end"}),"scene"==r&&(space[l][i][s]={fixed:n,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:0,slope:0,angle:a,equation:"false"},0==a?space[l][i][s].linkable.d=[l,i+1,s]:90==a?space[l][i][s].linkable.l=[l-1,i,s]:180==a?space[l][i][s].linkable.u=[l,i-1,s]:270==a&&(space[l][i][s].linkable.r=[l+1,i,s]));else if(3==e)C.plane({g:c,w:.8*size,h:sizeh,z:sizeh/2,rx:-88,b:"linear-gradient(90deg, #666 5px, transparent 5px, transparent 75px, #666 75px),linear-gradient(#5ae 25px,transparent 25px)",o:"center"}),"scene"==r&&(space[l][i][s]={fixed:n,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:0,slope:0,angle:a,equation:"false"},0==a?(space[l][i][s].linkable.u=[l,i-1,s],space[l][i][s].linkable.d=[l,i+1,s]):90==a?(space[l][i][s].linkable.r=[l+1,i,s],space[l][i][s].linkable.l=[l-1,i,s]):180==a?(space[l][i][s].linkable.u=[l,i-1,s],space[l][i][s].linkable.d=[l,i+1,s]):270==a&&(space[l][i][s].linkable.l=[l-1,i,s],space[l][i][s].linkable.r=[l+1,i,s]));else if(4==e)C.plane({g:c,w:.8*size,h:.7*size,y:.2*size,z:sizeh/4,rx:-20,b:"#d00",o:"center"}),C.plane({g:c,w:.8*size,h:.2*size,y:-10,rx:-90,z:.2*sizeh,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",o:"center"}),"scene"==r&&(space[l][i][s]={fixed:n,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:0,slope:1,angle:a,equation:"todo"},0==a?space[l][i][s].linkable.d=[l,i+1,s]:90==a?space[l][i][s].linkable.l=[l-1,i,s]:180==a?space[l][i][s].linkable.u=[l,i-1,s]:270==a&&(space[l][i][s].linkable.r=[l+1,i,s]));else if(5==e)C.plane({g:c,z:sizeh/2,w:.8*size,h:112,o:"center",b:"#d90",rx:-26.5}),C.plane({g:c,w:.8*size,h:40,y:-40,rx:-90,z:20,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",o:"center"}),"scene"==r&&(space[l][i][s]={fixed:n,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:[[l,i,s+1]],surrogate_of:0,slope:1,angle:a,equation:"todo"},0==a?(space[l][i][s].linkable.u=[l,i-1,s+1],space[l][i][s].linkable.d=[l,i+1,s]):90==a?(space[l][i][s].linkable.l=[l-1,i,s],space[l][i][s].linkable.r=[l+1,i,s+1]):180==a?(space[l][i][s].linkable.u=[l,i-1,s],space[l][i][s].linkable.d=[l,i+1,s+1]):270==a&&(space[l][i][s].linkable.l=[l-1,i,s+1],space[l][i][s].linkable.r=[l+1,i,s]),space[l][i][s+1]={fixed:n,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:[l,i,s],slope:1,angle:a,equation:"todo"});else if(6==e){if(C.plane({g:c,w:.8*size,h:105,z:.36*sizeh,o:"center",b:"#d90",rx:-20}),C.plane({g:c,y:-size,z:.84*sizeh,w:.8*size,h:107,o:"center",b:"#d90",rx:-7}),C.plane({g:c,w:.8*size,h:sizeh,y:-size-40,rx:-90,z:.4*sizeh,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",o:"center"}),C.plane({g:c,w:.8*size,h:.6*sizeh,y:-40,rx:-90,z:.3*sizeh,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",o:"center"}),"scene"==r)space[l][i][s]={fixed:n,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:[[l,i,s+1]],surrogate_of:0,slope:1,angle:a,equation:"todo"},0==a?(space[l][i][s].linkable.u=[l,i-2,s+1],space[l][i][s].linkable.d=[l,i+1,s],space[l][i][s].surrogates.push([t=l,b=i-1,k=s])):90==a?(space[l][i][s].linkable.l=[l-1,i,s],space[l][i][s].linkable.r=[l+2,i,s+1],space[l][i][s].surrogates.push([t=l+1,b=i,k=s])):180==a?(space[l][i][s].linkable.u=[l,i-1,s],space[l][i][s].linkable.d=[l,i+2,s+1],space[l][i][s].surrogates.push([t=l,b=i+1,k=s])):270==a&&(space[l][i][s].linkable.l=[l-2,i,s+1],space[l][i][s].linkable.r=[l+1,i,s],space[l][i][s].surrogates.push([t=l-1,b=i,k=s])),space[l][i][s].surrogates.push([t,b,k+1]),space[t][b][k]||space[t][b][k+1]?(C.$(c).remove(),space[l][i][s]=0,cursor.style.background="#e668"):(space[t][b][k]={fixed:1,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:[l,i,s],slope:1,angle:a,equation:"todo"},space[l][i][s+1]={fixed:1,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:[l,i,s],slope:1,angle:a,equation:"todo"},space[t][b][k+1]={fixed:1,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:[l,i,s],slope:1,angle:a,equation:"todo"})}else if(7==e){var t,b;if(C.plane({g:c,w:.8*size,h:105,z:6,o:"center",b:"#d90",rx:-7}),C.plane({g:c,y:-size,z:32,w:.8*size,h:107,o:"center",b:"#d90",rx:-20}),C.plane({g:c,w:.8*size,h:sizeh,y:-size-40,rx:-90,z:.4*sizeh,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",o:"center"}),C.plane({g:c,w:.8*size,h:.2*sizeh,y:-40,rx:-90,z:.1*sizeh,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",o:"center"}),"scene"==r)space[l][i][s]={fixed:n,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:[[l,i,s+1]],surrogate_of:0,slope:1,angle:a,equation:"todo"},0==a?(space[l][i][s].linkable.u=[l,i-2,s+1],space[l][i][s].linkable.d=[l,i+1,s],space[l][i][s].surrogates.push([t=l,b=i-1,k=s])):90==a?(space[l][i][s].linkable.l=[l-1,i,s],space[l][i][s].linkable.r=[l+2,i,s+1],space[l][i][s].surrogates.push([t=l+1,b=i,k=s])):180==a?(space[l][i][s].linkable.u=[l,i-1,s],space[l][i][s].linkable.d=[l,i+2,s+1],space[l][i][s].surrogates.push([t=l,b=i+1,k=s])):270==a&&(space[l][i][s].linkable.l=[l-2,i,s+1],space[l][i][s].linkable.r=[l+1,i,s],space[l][i][s].surrogates.push([t=l,b=i-1,k=s])),space[l][i][s].surrogates.push([t,b,k+1]),space[t][b][k]||space[t][b][k+1]?(C.$(c).remove(),space[l][i][s]=0,cursor.style.background="#e668"):(space[t][b][k]={fixed:1,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:[l,i,s],slope:1,angle:a,equation:"todo"},space[l][i][s+1]={fixed:1,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:[l,i,s],slope:1,angle:a,equation:"todo"},space[t][b][k+1]={fixed:1,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:[l,i,s],slope:1,angle:a,equation:"todo"})}else if(8==e)C.plane({g:c,z:1,w:.8*size,h:size,o:"center",css:"acc",rz:180}),"scene"==r&&(space[l][i][s]={fixed:n,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogate:0,slope:0,angle:a,equation:"false"},0==a?(space[l][i][s].linkable.u=[l,i-1,s],space[l][i][s].linkable.d=[l,i+1,s]):90==a?(space[l][i][s].linkable.l=[l-1,i,s],space[l][i][s].linkable.r=[l+1,i,s]):180==a?(space[l][i][s].linkable.u=[l,i-1,s],space[l][i][s].linkable.d=[l,i+1,s]):270==a&&(space[l][i][s].linkable.l=[l-1,i,s],space[l][i][s].linkable.r=[l+1,i,s]));else if(9==e)C.plane({g:c,w:.8*size,h:112,z:sizeh/2,o:"center",css:"acc",rx:-26.5}),C.plane({g:c,w:.8*size,h:40,y:-40,rx:-90,z:20,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",o:"center"}),"scene"==r&&(space[l][i][s]={fixed:n,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:[[l,i,s+1]],surrogate_of:0,slope:1,angle:a,equation:"todo"},0==a?(space[l][i][s].linkable.u=[l,i-1,s+1],space[l][i][s].linkable.d=[l,i+1,s]):90==a?(space[l][i][s].linkable.l=[l-1,i,s],space[l][i][s].linkable.r=[l+1,i,s+1]):180==a?(space[l][i][s].linkable.u=[l,i-1,s],space[l][i][s].linkable.d=[l,i+1,s+1]):270==a&&(space[l][i][s].linkable.l=[l-1,i,s+1],space[l][i][s].linkable.r=[l+1,i,s]),space[l][i][s+1]={fixed:1,free:0,id:e,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:1,r:1,d:1,l:1},surrogates:0,surrogate_of:[l,i,s],slope:1,angle:a,equation:"todo"});else if(10==e)C["scene"==r||"vcursor"==r?"sprite":"plane"]({g:c,w:size,h:size,y:0,z:0,rx:-90,html:"🌲",css:"tree",o:"bottom"}),"scene"==r&&(space[l][i][s]={fixed:n,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:0,r:0,d:0,l:0},surrogates:0,surrogate_of:0,slope:0,angle:0,equation:"todo"},space[l][i][s+1]={fixed:n,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:0,r:0,d:0,l:0},surrogates:0,surrogate_of:0,slope:0,angle:0,equation:"todo"});else if(11==e&&(C.cube({g:c,w:100,h:sizeh*s+sizeh,z:-sizeh*s,d:100,b:"#aaa",b2:"#777",b3:"#999"}),"scene"==r))for(var k=0;k<=s;k++)space[l][i][k]={fixed:n,free:0,id:e,inventoryid:selected,linkable:{u:0,r:0,d:0,l:0},links:{u:0,r:0,d:0,l:0},flat:{u:1,r:1,d:1,l:1},barriers:{u:0,r:0,d:0,l:0},surrogates:0,surrogate_of:0,slope:0,angle:0,equation:"todo"};s>0&&4!=e&&0!=e&&11!=e&&(C.plane({g:c,w:.8*size,h:sizeh*s,y:-40,z:sizeh*(-s/2),rx:-90,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",o:"center"}),C.plane({g:c,w:.8*size,h:sizeh*s,y:40,z:sizeh*(-s/2),rx:-90,b:"linear-gradient(90deg,#666 5px,transparent 5px, transparent 75px, #666 75px)",o:"center"}))};setInterval(()=>{if(1==mode&&editor(),2==mode){for(times=0;times<5;times++){delog(),log("oob",oob),u?(carspeed+=.002)>(oob?.2:.4)&&(carspeed=oob?.2:.4):d?(carspeed-=.0015)<(oob?-.15:-.3)&&(carspeed=oob?-.15:-.3):carspeed*=.99,l&&u||r&&d?carrz-=.7:(r&&u||l&&d)&&(carrz+=.7),carx+=carspeed*Math.sin(toRadians(carrz)),cary-=carspeed*Math.cos(toRadians(carrz));var e=[carx+2*Math.sin(toRadians(carrz)),cary-2*Math.cos(toRadians(carrz)),0],i=[carx+-2*Math.sin(toRadians(carrz)),cary- -2*Math.cos(toRadians(carrz)),0];fcell=[~~(e[0]/size),~~(e[1]/size),0],bcell=[~~(i[0]/size),~~(i[1]/size),0],carspeed>=0?testcollision(e,fcell,fcellinfo):testcollision(i,bcell,bcellinfo),frontcell=fcell,backcell=bcell}collision&&(carspeed=speedduringcollision>=0?-.05:.05,(collision-=.1)<=0&&(collision=0)),C.camera({x:carx,y:cary,rz:-carrz}),C.move({n:"car",x:carx,y:cary,rz:carrz+90})}S=_=U=L=D=R=0},33)</script>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:calibri;cursor:pointer;user-select:none;-moz-user-select:none}#viewport{width:100vw;height:100vh;background:#fff;overflow:hidden;position:relative;perspective:500px}#viewport *,.part *{transform-style:preserve-3d;box-sizing:border-box}#camera{width:0;height:0;position:absolute;top:50%;left:50%}.circle{border-radius:50%}#deb{position:fixed;top:0;left:0;z-index:2;top:-999px;font-size:10px}.plane{text-align:center;font-size:25px;line-height:20px}.block0.z0{border:1px solid #ddd}.barrierleftright.z0{border-left:5px solid #000;border-right:5px solid #000}.barriertopbottom.z0{border-top:5px solid #000;border-bottom:5px solid #000}#grid{background:linear-gradient(#888 2px,transparent 2px),linear-gradient(90deg,#888 2px,transparent 2px),#def8;background-size:100px 100px}#menu{position:fixed;left:0;top:0;text-align:center;width:145px;background:#fff;padding:5px;border:2px solid}#menu div{width:60px;display:inline-block;height:30px;border:2px solid #555;background:#eee;font-size:20px;margin:2px 0}#parts{position:fixed;bottom:0;text-align:center;width:100%}.part{width:60px;height:80px;border:2px solid #555;background:#ddd;display:inline-block;vertical-align:top;perspective:500px}.part.selected{background:#fff}.visual{height:30px;margin:25px 30px 0}.editor #scene{transition:.2s linear}p{text-align:left;background:#eee;margin:0 2px;padding:5px}#cursor{transition:.1s linear}.tree{font-size:90px;line-height:90px;text-align:center;transition:.2s linear}.acc{background:linear-gradient(70deg,transparent 75%,#fd3 75%) center center,linear-gradient(-70deg,#d90 75%,#fd3 75%) center center,#d90;background-size:26px 24px}